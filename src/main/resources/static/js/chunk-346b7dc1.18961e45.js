(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-346b7dc1"],{"1d3a":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"fit-parent"},[a("div",{staticClass:"order-manage-div jquery-scrollbar-element scrollbar-macosx"},[a("div",{staticClass:"padding24"},[t._m(0),a("div",{staticClass:"orders-div"},[a("div",{staticClass:"tools-div"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:t.searchInfo}},[a("el-form-item",[a("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择",size:"small"},model:{value:t.orderStatus,callback:function(e){t.orderStatus=e},expression:"orderStatus"}},t._l(t.statusList,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),a("el-form-item",[a("el-input",{staticClass:"search-input",attrs:{size:"small",placeholder:"请输入用户昵称/联系方式/订单编号","prefix-icon":"el-icon-search"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getSearchInfo()}},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}})],1),a("el-form-item",[a("el-button",{attrs:{size:"small",plain:"",type:"primary",icon:"el-icon-search"},on:{click:function(e){return t.getSearchInfo()}}},[t._v("查询")])],1)],1)],1),a("div",{staticClass:"order-table"},[a("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":t.updateInfo},model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},[a("el-tab-pane",{attrs:{label:"订单列表",name:"menuList"}},[a("i",{staticClass:"el-icon-refresh refresh-table",on:{click:function(e){return t.updateInfo()}}}),a("div",{staticClass:"table-div jquery-scrollbar-element scrollbar-macosx"},[a("div",{staticClass:"inline-block"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableInfo.tableData,border:""},on:{"expand-change":t.updateScrollbar}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[t._l(t.tableInfo.stringMap,(function(n,o){return a("el-form-item",{key:n.id,attrs:{label:t.tableInfo.stringMap[o]}},[a("span",[t._v(t._s(e.row[o]))])])})),a("el-form-item",{attrs:{label:"订单内容"}},t._l(e.row.orderDetailList,(function(e){return a("div",{key:e.detailId},[t._v(" "+t._s(e.productName)+" ¥"+t._s(e.productPrice)+" x "+t._s(e.productQuantity)+" ")])})),0),a("el-form-item",{attrs:{label:"评论内容"}},[a("div",[t.commentMap[e.row.orderId]?a("div",[t.commentMap[e.row.orderId].empty?a("span",[t._v("暂无评论")]):a("span",[t._v(t._s(t.commentMap[e.row.orderId].content))])]):a("el-button",{on:{click:function(a){return t.findComment(e.row.orderId)}}},[t._v("查看评价")])],1)])],2)]}}])}),a("el-table-column",{attrs:{width:"80",label:"订单 ID",prop:"orderId"}}),a("el-table-column",{attrs:{label:"用户名称",prop:"buyerName"}}),a("el-table-column",{attrs:{label:"订单金额",prop:"orderAmount"}}),a("el-table-column",{attrs:{label:"联系方式",prop:"buyerPhone"}}),a("el-table-column",{attrs:{label:"订单状态",prop:"orderStatusStr"}}),a("el-table-column",{attrs:{label:"操作",width:"320"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.orderStatus==t.actionMap["new"].status?a("el-button",{attrs:{type:"warning",icon:"el-icon-coin",size:"small"},on:{click:function(a){return t.changeStatus(e.$index,"pay")}}},[t._v("支付")]):t._e(),t.actionMap["over"].status>e.row.orderStatus?a("el-button",{attrs:{type:"success",icon:"el-icon-check",size:"small"},on:{click:function(a){return t.changeStatus(e.$index,"over")}}},[t._v("确认收货")]):t._e(),e.row.orderStatus==t.actionMap["over"].status?a("el-button",{attrs:{type:"warning",icon:"el-icon-coin",size:"small"},on:{click:function(a){return t.showComment(e.$index)}}},[t._v("评价")]):t._e(),t.actionMap["over"].status>e.row.orderStatus?a("el-button",{attrs:{type:"danger",icon:"el-icon-close",size:"small"},on:{click:function(a){return t.changeStatus(e.$index,"cancel")}}},[t._v("取消订单")]):t._e()]}}])})],1)],1)]),a("div",{staticClass:"pager-div"},[a("el-pagination",{attrs:{"current-page":t.tableInfo.page_num,"page-sizes":[6,8,10,15,20,30],"page-size":t.tableInfo.page_size,layout:"total, sizes, prev, pager, next, jumper",total:t.tableInfo.total_num,"pager-count":5,size:"small"},on:{"size-change":t.changePageSize,"current-change":t.changePage}})],1)]),a("el-tab-pane",{attrs:{label:"搜索结果",name:"searchResult"}},[a("i",{staticClass:"el-icon-refresh refresh-table",on:{click:function(e){return t.updateInfo(!0)}}}),a("div",{staticClass:"table-div jquery-scrollbar-element scrollbar-macosx"},[a("div",{staticClass:"inline-block"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.searchInfo.tableData,border:""},on:{"expand-change":t.updateScrollbar}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[t._l(t.tableInfo.stringMap,(function(n,o){return a("el-form-item",{key:n.id,attrs:{label:t.tableInfo.stringMap[o]}},[a("span",[t._v(t._s(e.row[o]))])])})),a("el-form-item",{attrs:{label:"订单内容"}},t._l(e.row.orderDetailList,(function(e){return a("div",{key:e.detailId},[t._v(" "+t._s(e.productName)+" ¥"+t._s(e.productPrice)+" x "+t._s(e.productQuantity)+" ")])})),0)],2)]}}])}),a("el-table-column",{attrs:{width:"80",label:"订单 ID",prop:"orderId"}}),a("el-table-column",{attrs:{label:"用户名称",prop:"buyerName"}}),a("el-table-column",{attrs:{label:"订单金额",prop:"orderAmount"}}),a("el-table-column",{attrs:{label:"联系方式",prop:"buyerPhone"}}),a("el-table-column",{attrs:{label:"订单状态",prop:"orderStatusStr"}}),a("el-table-column",{attrs:{label:"操作",width:"320"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.orderStatus==t.actionMap["new"].status?a("el-button",{attrs:{type:"warning",icon:"el-icon-coin",size:"small"},on:{click:function(a){return t.changeStatus(e.$index,"pay")}}},[t._v("支付")]):t._e(),t.actionMap["over"].status>e.row.orderStatus?a("el-button",{attrs:{type:"success",icon:"el-icon-check",size:"small"},on:{click:function(a){return t.changeStatus(e.$index,"over")}}},[t._v("确认收货")]):t._e(),e.row.orderStatus==t.actionMap["over"].status?a("el-button",{attrs:{type:"warning",icon:"el-icon-coin",size:"small"},on:{click:function(a){return t.showComment(e.$index)}}},[t._v("评价")]):t._e(),t.actionMap["over"].status>e.row.orderStatus?a("el-button",{attrs:{type:"danger",icon:"el-icon-close",size:"small"},on:{click:function(a){return t.changeStatus(e.$index,"cancel")}}},[t._v("取消订单")]):t._e()]}}])})],1)],1)]),a("div",{staticClass:"pager-div"},[a("el-pagination",{attrs:{"current-page":t.searchInfo.page_num,"page-sizes":[6,8,10,15,20,30],"page-size":t.searchInfo.page_size,layout:"total, sizes, prev, pager, next, jumper",total:t.searchInfo.total_num,"pager-count":5,size:"small"},on:{"size-change":t.changeSearchPageSize,"current-change":t.changeSearchPage}})],1)])],1)],1),a("el-dialog",{attrs:{title:"评价订单",visible:t.comentVisible,"modal-append-to-body":!1},on:{"update:visible":function(e){t.comentVisible=e}}},[a("el-form",{attrs:{model:t.commentOrder}},[a("el-form-item",{attrs:{label:"订单编号:","label-width":"120px"}},[a("div",[t._v(t._s(t.commentOrder.orderId))])]),a("el-form-item",{attrs:{label:"订单内容:","label-width":"120px"}},[a("div",t._l(t.commentOrder.orderDetailList,(function(e){return a("span",{key:e.detailId,staticStyle:{"border-right":"1px solid #ccc","padding-right":"10px","margin-right":"10px"}},[t._v(" "+t._s(e.productName)+" ¥"+t._s(e.productPrice)+" x "+t._s(e.productQuantity)+" ")])})),0)]),a("el-form-item",{attrs:{label:"评价内容","label-width":"120px"}},[a("el-input",{attrs:{autocomplete:"off"},nativeOn:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.comentVisible=!1,t.addComment()}},model:{value:t.commentOrder.content,callback:function(e){t.$set(t.commentOrder,"content",e)},expression:"commentOrder.content"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.comentVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.comentVisible=!1,t.addComment()}}},[t._v("确 定")])],1)],1)],1)])])])},o=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"title-div"},[a("h2",{staticClass:"title-text"},[a("span",[t._v("订单管理")])])])}],r=(a("b4fb"),a("fe59"),a("d497"),a("08ba"),a("88d6")),s=a("80a0"),l=a("1f75"),i={data:function(){var t={commentMap:{},comentVisible:!1,commentOrder:{orderId:"",orderDetailList:[],content:""},activeTab:"menuList",statusList:[{label:"全部",value:-1},{label:"新订单未支付",value:0},{label:"已支付/接单",value:1},{label:"配送中",value:3},{label:"已完结",value:4},{label:"已评价",value:5},{label:"已取消",value:6}],actionMap:{new:{status:0},pay:{url:"/user/order/confirmPay",tips:"确认支付",status:1},accept:{url:"/user/order/confirmPay",tips:"确认接单",status:1},delivery:{status:3},over:{url:"/user/order/finish",tips:"确认完结",status:4},comment:{status:5},cancel:{url:"/user/order/cancel",tips:"订单取消",status:6}},statusMap:{},searchInfo:{keyword:"",orderStatus:-1,page_num:1,page_size:8,total_num:1,tableData:[]},orderStatus:-1,keyword:"",tableInfo:{page_num:1,page_size:8,total_num:1,stringMap:{orderId:"订单ID",buyerName:"用户名称",buyerAddress:"地址",buyerPhone:"联系方式",updateTime:"更新时间",createTime:"创建时间"},tableData:[]}};return t.statusList.forEach((function(e){t.statusMap[e.value]=e.label})),t},mounted:function(){this.$(".jquery-scrollbar-element").scrollbar(),this.getTableInfo()},methods:{findComment:function(t){var e=this,a="获取评论";l["a"].post("/user/comment/find",{orderId:t}).then((function(n){var o;n&&1==n.code?(o=n.data?n.data:{empty:!0},e.commentMap=Object(s["a"])(Object(s["a"])({},e.commentMap),{},Object(r["a"])({},t,o)),console.log(e.commentMap)):e.$alert(n.tips,a+"失败",{confirmButtonText:"确定"})}))},showComment:function(t){this.commentOrder=Object(s["a"])(Object(s["a"])({},this.tableInfo.tableData[t]),{},{content:""}),this.comentVisible=!0},addComment:function(){var t=this,e=this.commentOrder.orderId,a=this.commentOrder.content;if(e+""&&a){var n="评价订单";l["a"].post("/user/comment/save",{orderId:e,content:a}).then((function(e){e&&1==e.code?t.$message({message:n+"成功",type:"success"}):t.$alert(e.tips,n+"失败",{confirmButtonText:"确定"})}))}else{var o=a?"请重新选择要评价的订单":"请输入评价内容";this.$confirm(o,"未提交",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),this.updateInfo()}},updateScrollbar:function(t,e){var a=this;this.$nextTick((function(){0!=e.length&&!0!==t||a.$(".table-div").updateScrollbars(!0)}))},changeSearchPage:function(t){this.searchInfo.page_num=t,this.getSearchInfo(!0)},changeSearchPageSize:function(t){this.searchInfo.page_size=t,this.getSearchInfo(!0)},changePage:function(t){this.tableInfo.page_num=t,this.getTableInfo()},changePageSize:function(t){this.tableInfo.page_size=t,this.getTableInfo()},updateInfo:function(){this.commentMap={},console.log(this.commentMap),"menuList"==this.activeTab?this.getTableInfo():this.getSearchInfo(!0)},getTableInfo:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=e?this.searchInfo:this.tableInfo,n={};e&&(n={keyword:this.searchInfo.keyword,status:this.searchInfo.orderStatus}),l["a"].get("/user/order/list",Object(s["a"])({page_num:a.page_num,page_size:a.page_size},n)).then((function(a){a&&1==a.code&&a.data&&(a.data.tableData.forEach((function(e){e.orderStatusStr=t.statusMap[e.orderStatus]})),e?t.searchInfo=Object.assign(t.searchInfo,a.data):t.tableInfo=Object.assign(t.tableInfo,a.data))}))},getSearchInfo:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t||(this.searchInfo.keyword=this.keyword,this.searchInfo.orderStatus=this.orderStatus),this.activeTab="searchResult",this.getTableInfo(!0)},changeStatus:function(t,e){var a=this,n=this.actionMap[e],o=n.url,r=n.tips,s="menuList"==this.activeTab?this.tableInfo:this.searchInfo,i=s.tableData[t].orderId;this.$confirm("将".concat(i,"号订单").concat(r,", 是否继续?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){l["a"].get(o,{orderId:i}).then((function(t){if(t&&1==t.code){a.$message({message:r+"成功",type:"success"});var e=-1;s.tableData.some((function(t,a){if(t.orderId==i)return e=a,!0}));var o=n.status;e>=0&&(s.tableData[e].orderStatus=o,s.tableData[e].orderStatusStr=a.statusMap[o])}else a.$alert(t.tips,r+"失败",{confirmButtonText:"确定"})}))}))["catch"]((function(){a.$message({type:"info",message:"已取消"})}))}}},c=i,u=(a("7a77"),a("4023")),d=Object(u["a"])(c,n,o,!1,null,"d5359eda",null);e["default"]=d.exports},"7a77":function(t,e,a){"use strict";var n=a("f95e"),o=a.n(n);o.a},f95e:function(t,e,a){}}]);
//# sourceMappingURL=chunk-346b7dc1.18961e45.js.map